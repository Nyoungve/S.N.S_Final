<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%-- <%
	String path = request.getContextPath(); //첫번째 경로를 가져온다
	request.setCharacterEncoding("UTF-8");
%> --%>
<script type="text/javascript">
// JavaScript Document
$(document).ready(function($) { // HTML 문서를 모두 읽으면 포함한 코드를 실행
	"use strict"; // http://hmmim.tistory.com/5
	// 정규식을 변수에 할당
	// 정규식을 직접 작성할 줄 알면 참 좋겠지만
	// 변수 우측에 할당된 정규식은 검색하면 쉽게 찾을 수 있다.
	// 이 변수들의 활약상을 기대한다.
	// 변수 이름을 're_'로 정한것은 'Reguar Expression'의 머릿글자
	var re_id = /^[a-z0-9_-]{3,16}$/;
	var re_pw = /^[a-z0-9_-]{6,18}$/;
	var re_mail = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/;

	// 선택할 요소를 변수에 할당
	// 변수에 할당하지 않으면 매번 HTML 요소를 선택해야 하기 때문에 귀찮고 성능에도 좋지 않다.
	// 쉼표를 이용해서 여러 변수를 한 번에 선언할 수 있다.
	// 보기 좋으라고 쉼표 단위로 줄을 바꿨다.
	var 
		SignUpform = $('#SignUp'), /* modal_login.jsp 회원가입form  id 저장 */
		LoginForm = $('#LoginForm'), /* modal_login.jsp 로그인form id 저장 */
		IDSearch = $('#IDSearch'), /* modal_login.jsp 아이디체크form 저장 */
		PWSearch = $('#PWSearch'), /* modal_login.jsp 암호체크form id 저장 */
		
		/* 다른 form에서도 같은 id 값을 사용한다. */
		uid = $('#userid'),		/* form의 아이디값 저장 */
		upw1 = $('#password1'), /* form의  암호값 저장 */
		upw2 = $('#password2'),	/* form의  암호값 저장   : 회원가입시 암호 확인용으로 만 쓰인다.*/
		mail = $('#E-mail'),	/* form의  이메일값 저장 */
		mobile = $('#mobile');	/* form의  전화번호값 저장 */
		var LoginIdStatus = ${msg == 'IdFailure'};
		var	LoginPwStatus = ${msg == 'PwFailure'};

		//LoginForm
		LoginForm.submit(function(){
	        if(LoginIdStatus) {
	        	$('#id_value').html("<span class='glyphicon glyphicon-remove'></span>일치하는 아이디가 없습니다.");
	        	uid.focus();
				return false;
	        }
	        
	        if(LoginPwStatus) {
	        	$('#pw_value').html("<span class='glyphicon glyphicon-remove'></span>아이디 또는 비밀번호가 일치하지 않습니다.");
	        	upw1.focus();
				return false;
	        }
		});

	// 선택한 form에 서밋 이벤트가 발생하면 실행한다.
	// if (사용자 입력 값이 정규식 검사에 의해 참이 아니면) {포함한 코드를 실행}
	// if 조건절 안의 '정규식.test(검사할값)' 형식은 true 또는 false를 반환한다.
	// if 조건절 안의 검사 결과가 '!== true' 참이 아니면 {...} 실행
	// 사용자 입력 값이 참이 아니면 alert을 띄운다.
	// 사용자 입력 값이 참이 아니면 오류가 발생한 input으로 포커스를 보낸다.
	// 사용자 입력 값이 참이 아니면 form 서밋을 중단한다.
	SignUpform.submit(function() {
		if (re_id.test(uid.val()) != true) { // 아이디 검사
			alert('[ID 입력 오류] 유효한 ID를 입력해 주세요.\n - 영문, 숫자, 언더스코어(_), 하이픈(-)이 포함 3~16 문자'); 
			uid.val("");
			uid.focus();
			return false;
		} else if (re_pw.test(upw1.val()) != true) { // 비밀번호 검사
			alert('[PW 입력 오류] 유효한 PW를 입력해 주세요.\n - 영문, 숫자, 언더스코어(_), 하이픈(-) 포함 6~18문자');
			upw1.val("");
			upw1.focus();
			return false;
		} else if (upw1.val() != upw2.val()) { // 비밀번호 중복검사
			alert('[PW 입력 오류] 입력한 pw가 서로 다릅니다.');
			upw1.val("");
			upw2.val("");
			upw1.focus();
			return false;
		} else if (re_mail.test(mail.val()) != true) {
			alert('[E-mail 입력 오류] 유효한 E-mail을 입력해 주세요');
			mail.val("");
			mail.focus();
			return false;
		}
	});

	
	$(function() {
		mobile.on('keydown',function(e){
			// 숫자만 입력받기
			var trans_num = $(this).val().replace(/-/gi, '');
			var k = e.keyCode;
			if (trans_num.length >= 11 && ((k >= 48 && k <= 126) || (k >= 12592 && k <= 12687 || k == 32 || k == 229 || (k >= 45032 && k <= 55203)))) {
				e.preventDefault();
			}
		}).on('blur',function() {
			if ($(this).val() == '')
				return;
			var trans_num = $(this).val()
					.replace(/-/gi, '');
			if (trans_num != null && trans_num != '') {
				if (trans_num.length == 11 || trans_num.length == 10) {
					var regExp_ctn = /^(01[016789]{1}|02|0[3-9]{1}[0-9]{1})([0-9]{3,4})([0-9]{4})$/;
					if (regExp_ctn.test(trans_num)) {
						trans_num = trans_num.replace(
							/^(01[016789]{1}|02|0[3-9]{1}[0-9]{1})-?([0-9]{3,4})-?([0-9]{4})$/,"$1-$2-$3");
						$(this).val(trans_num);
					} else {
						alert("유효하지 않은 전화번호 입니다.");
						$(this).val("");
						$(this).focus();
					}
				} else {
					alert("유효하지 않은 전화번호 입니다.");
					$(this).val("");
					$(this).focus();
				}
			}
		});
	});
	
	//ID찾기
	IDSearch.submit(function(){
		if(IDValue == "1") {
			$('#IDResult').text("E-mail과 일치하는 이름이 없습니다.");
			$('#id').focus();
			return false;
		} else if(IDValue == "2") {
			$('#IDResult').text("이름과 일치하는 E-mail이 없습니다.");
			$('#email').focus();
			return false;
		} else if(IDValue == "3") {
			$('#IDResult').text("가입하신 E-mail로 아이디를 발송하였습니다.");
			return false;
		}
	});

	//PW찾기 
	PWSearch.submit(function() {
		if(PWValue == "1") {
			$('#PWResult').text("E-mail과 일치하는 이름이 없습니다.");
			$('#id').focus();
			return false;
		} else if(PWValue == "2"){
			$('#PWResult').text("이름과 일치하는 E-mail이 없습니다.");
			$('#email').focus();
			return false;
		} else if(PWValue == "3"){
		$('#PWResult').text("입력하신 ID가 존재하지 않습니다.");
		$('#email').focus();
			return false;
		} else if(PWValue == "4"){
		$('#PWResult').text("가입하신 E-mail로 암호를 발송하였습니다.");
			return false;
		}
	});
	
	$(function(){
	    $('#datepicker').datepicker({
	      inline: true,
	      showOtherMonths: true,
	      dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
	    });
	  });
	
	
});
</script>